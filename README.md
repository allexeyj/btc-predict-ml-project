# Этап 5: Реализация Сервиса (FastAPI и Streamlit)

Пятый этап проекта посвящен созданию полноценного сервиса, который позволяет взаимодействовать с обученной моделью машинного обучения. Основные компоненты этого этапа включают:

*   **FastAPI Backend**: Разработка HTTP API для взаимодействия с моделью предсказания.
*   **Streamlit Frontend**: Создание веб-приложения для визуализации данных, взаимодействия с моделью и демонстрации аналитики.
*   **Контейнеризация**: Упаковка всего решения с использованием Docker и Docker Compose для упрощения развертывания и управления.
*   **Логирование**: Внедрение механизма логирования для отслеживания работы сервисов.

## FastAPI Backend

Серверная часть реализована с использованием фреймворка FastAPI, который предоставляет быстрый и современный способ создания API. Основные функции API включают:

*   **Загрузка моделей**: При запуске сервера происходит загрузка предобученных моделей из директории `model_store`. 
*   **`GET /models`**: Возвращает список доступных моделей на сервере с их описанием.
*   **`POST /set_active_model`**: Устанавливает активную модель для предсказаний.
*   **`POST /predict`**: Принимает текстовые данные (заголовки новостей) и возвращает предсказание цены биткоина с использованием активной модели.
*   **`POST /fit`**: Запускает процесс обучения модели в фоновом режиме. Принимает гиперпараметры для обучения.

### Технические Детали FastAPI

*   **Аннотации типов**: Все аргументы и возвращаемые значения в API ручках аннотированы с использованием `Annotated[]` (или `->` для возвращаемых значений) и Pydantic моделей для валидации данных.
*   **Pydantic Модели**: Определены в `app/models.py` для структурирования запросов и ответов API (`PredictRequest`, `PredictResponse`, `FitRequest`, `ModelInfo`, `SetActiveModelRequest`).
*   **Логирование**: Реализовано полноценное логирование с механизмом ротации, сохраняющее логи в папку `logs/`.
*   **Сервис-слой**: Бизнес-логика для работы с моделями (загрузка, предсказание, обучение, управление активной моделью) вынесена в `app/service.py`.

## Streamlit Frontend

Веб-приложение, разработанное с использованием Streamlit. Оно предоставляет пользовательский интерфейс для взаимодействия с FastAPI бэкендом.

## Контейнеризация (Docker и Docker Compose)

Весь проект упакован в Docker контейнеры для обеспечения переносимости и простоты развертывания. `docker-compose.yml` оркестрирует запуск обоих сервисов.

### `Dockerfile.fastapi`

Определяет Docker образ для FastAPI сервиса. Включает установку зависимостей из `requirements.txt`, копирование исходного кода и запуск `uvicorn` сервера.

### `Dockerfile.streamlit`

Определяет Docker образ для Streamlit приложения. Включает установку зависимостей и запуск Streamlit сервера.

### `docker-compose.yml`

Определяет два сервиса:

*   `fastapi-app`: Сервис для FastAPI бэкенда, использующий `Dockerfile.fastapi`.
*   `streamlit-app`: Сервис для Streamlit фронтенда, использующий `Dockerfile.streamlit`.

Оба сервиса настроены на взаимодействие друг с другом и монтируют общую директорию `logs` для централизованного хранения логов.

## Запуск Проекта

1.  **Клонировать репозиторий**:
    ```bash
    git clone https://github.com/allexeyj/btc-predict-ml-project.git
    cd btc-predict-ml-project
    git checkout stage_5
    ```
2.  **Запустить сервисы с помощью Docker Compose** из корневой директории проекта:
    ```bash
    docker-compose up --build
    ```

После успешного запуска:

*   FastAPI сервис будет доступен по адресу `http://localhost:8000`.
*   Streamlit приложение будет доступно по адресу `http://localhost:8501`.

## Логирование

Все логи из FastAPI и Streamlit сервисов будут сохраняться в директории `logs/` в корне проекта. Это позволяет легко отслеживать работу приложений и диагностировать возможные проблемы.

## Выводы

Этап 5 демонстрирует реализацию полноценного ML-сервиса с использованием современных инструментов и подходов. Интеграция FastAPI для бэкенда, Streamlit для фронтенда и Docker для контейнеризации обеспечивает легко развертываемое решение для предсказания курса биткоина.


